number: 21128
title: 'perf(engine): fixed-cache for execution cache'
state: open
author: shekhirin
head: alexey/execution-fixed-cache
base: main
labels:
- C-perf
- A-execution
created_at: 2026-01-16T16:24:54Z
updated_at: 2026-01-21T13:15:56Z
additions: 510
deletions: 583
is_draft: true
files:
- path: Cargo.lock
  additions: 14
  deletions: 95
- path: Cargo.toml
  additions: 1
  deletions: 1
- path: crates/cli/commands/src/test_vectors/compact.rs
  additions: 1
  deletions: 1
- path: crates/engine/primitives/src/config.rs
  additions: 15
  deletions: 5
- path: crates/engine/tree/Cargo.toml
  additions: 1
  deletions: 1
- path: crates/engine/tree/src/tree/cached_state.rs
  additions: 444
  deletions: 441
- path: crates/engine/tree/src/tree/payload_processor/mod.rs
  additions: 25
  deletions: 22
- path: crates/engine/tree/src/tree/payload_processor/multiproof.rs
  additions: 3
  deletions: 2
- path: crates/net/network/src/transactions/fetcher.rs
  additions: 1
  deletions: 7
- path: crates/node/core/src/args/engine.rs
  additions: 3
  deletions: 3
- path: crates/node/core/src/node_config.rs
  additions: 1
  deletions: 1
- path: crates/optimism/payload/src/validator.rs
  additions: 1
  deletions: 4
body: "Switches our execution cache from `mini-moka` to a lock-free `fixed-cache`. This is especially important for many transactions in prewarming that cause a lot of cache contention.\r\n\r\n## Benchmark\r\n\r\n100 big blocks (1Ggas each) on Ethereum Mainnet\r\n\r\n| Metric | main | fixed-cache | Î” |\r\n|--------|------|-------------|---|\r\n| Latency mean (ms) | 205.19 | 186.09 | **-9.3%** |\r\n| Latency p50 (ms) | 195.89 | 171.59 | **-12.4%** |\r\n| Throughput mean (Mgas/s) | 837.54 | 927.70 | **+10.8%** |\r\n| Throughput p50 (Mgas/s) | 870.07 | 934.44 | **+7.4%** |\r\n\r\n\r\n<img width=\"1800\" height=\"900\" alt=\"reth_elapsed_comparison\" src=\"https://github.com/user-attachments/assets/14390946-81dd-4ae0-bc52-92aa349b90fa\" />\r\n\r\n<img width=\"1800\" height=\"900\" alt=\"reth_throughput_comparison\" src=\"https://github.com/user-attachments/assets/52935c1f-3a61-4507-854d-8e82409f7657\" />\r\n\r\nResolves RETH-123\r\n"
