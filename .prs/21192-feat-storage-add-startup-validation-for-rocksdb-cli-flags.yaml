number: 21192
title: 'feat(storage): add startup validation for RocksDB CLI flags'
state: open
author: yongkangc
head: feat/rocksdb-cli-validation-v2
base: main
labels: []
created_at: 2026-01-19T15:00:14Z
updated_at: 2026-01-20T19:40:22Z
additions: 425
deletions: 14
is_draft: true
files:
- path: crates/cli/commands/src/node.rs
  additions: 8
  deletions: 1
- path: crates/node/builder/src/launch/common.rs
  additions: 20
  deletions: 12
- path: crates/node/core/src/args/mod.rs
  additions: 4
  deletions: 0
- path: crates/node/core/src/args/rocksdb.rs
  additions: 337
  deletions: 0
- path: crates/node/core/src/node_config.rs
  additions: 9
  deletions: 1
- path: crates/storage/db-common/src/init.rs
  additions: 3
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/node.mdx
  additions: 22
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/node.mdx
  additions: 22
  deletions: 0
body: "## Summary\nAdds startup validation to ensure `--rocksdb.*` flags match the persisted storage layout.\n\n## Behavior\n- If CLI override differs from initialized layout → startup error with actionable message\n- If CLI override matches or is not provided → startup proceeds\n\n## Changes\n- Added `validate_against_persisted()` method to `RocksDbArgs` \n- Added `RocksDbSettingsMismatchError` for clear error messages\n- Comprehensive tests for validation logic\n\n## Example Error\n```\n`--rocksdb.tx-hash` differs from initialized layout (expected false, got true). \nThis setting is genesis-only; re-sync required (remove datadir or use a new datadir).\n```\n\n## PR Stack\n1. #21191 - CLI flags ← **base**\n2. **This PR** - Validation logic\n3. #21190 - Docs (independent)"
