number: 20777
title: 'feat: support additional eth_subscribe handlers'
state: open
author: 0xKarl98
head: eth_subscribe
base: main
labels: []
created_at: 2026-01-06T11:19:33Z
updated_at: 2026-01-10T15:16:41Z
additions: 230
deletions: 56
is_draft: false
files:
- path: crates/rpc/rpc-eth-api/src/pubsub.rs
  additions: 3
  deletions: 4
- path: crates/rpc/rpc/src/eth/pubsub.rs
  additions: 227
  deletions: 52
body: "This closes #20750\r\n### Changes \r\n- Parse the subscription `kind` and raw params at the callsite: if the `kind` maps to a known `SubscriptionKind` (newHeads/logs/newPendingTransactions/syncing), we validate and normalize params upfront and then invoke the standard handlers. \r\n- If the `kind` is unknown, we try a per‑kind custom handler (registered via `register_handler`) first, then fall back to a global `fallback_handler` if configured; otherwise we return `invalid_params`.\r\n   - For known kinds, invalid params are rejected immediately with `invalid_params` to preserve strict RPC semantics and avoid masking client errors. Custom subscriptions are only accepted when explicitly registered (per‑kind handler or global fallback), and they must provide their own subscription stream; otherwise the request is rejected.\r\n\r\n-  Invalid paths are explicitly:\r\n    - Known kind + invalid params (e.g., `logs` expects `Filter`/none; `newPendingTransactions` expects `bool`/none; deserialization/type mismatch) → `invalid_params`.\r\n   - Unknown kind + no registered handler/fallback → `invalid_params`.\r\n   - Handler/fallback returns `Err(ErrorObject)` → forwarded as‑is (e.g., `invalid_params` or other error).\r\n\r\n\r\ncc @mattsse "
