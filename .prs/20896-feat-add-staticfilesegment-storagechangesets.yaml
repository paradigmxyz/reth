number: 20896
title: 'feat: add StaticFileSegment::StorageChangeSets'
state: open
author: Rjected
head: dan/storage-changesets-static-files
base: main
labels: []
created_at: 2026-01-09T18:51:20Z
updated_at: 2026-01-21T10:58:24Z
additions: 2264
deletions: 168
is_draft: false
files:
- path: Cargo.lock
  additions: 1
  deletions: 0
- path: crates/cli/commands/Cargo.toml
  additions: 1
  deletions: 0
- path: crates/cli/commands/src/db/get.rs
  additions: 34
  deletions: 0
- path: crates/cli/commands/src/db/settings.rs
  additions: 14
  deletions: 0
- path: crates/cli/commands/src/stage/drop.rs
  additions: 3
  deletions: 0
- path: crates/config/src/config.rs
  additions: 9
  deletions: 0
- path: crates/engine/tree/src/tree/mod.rs
  additions: 3
  deletions: 1
- path: crates/engine/tree/src/tree/payload_processor/multiproof.rs
  additions: 2
  deletions: 1
- path: crates/engine/tree/src/tree/payload_validator.rs
  additions: 3
  deletions: 1
- path: crates/node/core/src/args/static_files.rs
  additions: 20
  deletions: 0
- path: crates/node/core/src/node_config.rs
  additions: 1
  deletions: 0
- path: crates/stages/stages/src/stages/index_storage_history.rs
  additions: 17
  deletions: 6
- path: crates/stages/stages/src/stages/merkle.rs
  additions: 2
  deletions: 1
- path: crates/stages/stages/src/stages/merkle_changesets.rs
  additions: 4
  deletions: 2
- path: crates/stages/stages/src/stages/utils.rs
  additions: 66
  deletions: 7
- path: crates/static-file/types/src/segment.rs
  additions: 34
  deletions: 10
- path: crates/static-file/types/src/snapshots/reth_static_file_types__segment__tests__StorageChangeSets.snap
  additions: 5
  deletions: 0
- path: crates/storage/db-api/src/models/metadata.rs
  additions: 11
  deletions: 0
- path: crates/storage/db-api/src/models/mod.rs
  additions: 3
  deletions: 2
- path: crates/storage/db-models/src/lib.rs
  additions: 4
  deletions: 0
- path: crates/storage/db-models/src/storage.rs
  additions: 48
  deletions: 0
- path: crates/storage/db/src/static_file/masks.rs
  additions: 7
  deletions: 1
- path: crates/storage/provider/src/changeset_walker.rs
  additions: 79
  deletions: 2
- path: crates/storage/provider/src/either_writer.rs
  additions: 85
  deletions: 3
- path: crates/storage/provider/src/providers/blockchain_provider.rs
  additions: 20
  deletions: 0
- path: crates/storage/provider/src/providers/consistent.rs
  additions: 132
  deletions: 0
- path: crates/storage/provider/src/providers/database/provider.rs
  additions: 135
  deletions: 35
- path: crates/storage/provider/src/providers/state/historical.rs
  additions: 29
  deletions: 26
- path: crates/storage/provider/src/providers/state/overlay.rs
  additions: 7
  deletions: 1
- path: crates/storage/provider/src/providers/static_file/manager.rs
  additions: 257
  deletions: 11
- path: crates/storage/provider/src/providers/static_file/mod.rs
  additions: 323
  deletions: 5
- path: crates/storage/provider/src/providers/static_file/writer.rs
  additions: 75
  deletions: 2
- path: crates/storage/provider/src/test_utils/mock.rs
  additions: 33
  deletions: 2
- path: crates/storage/provider/src/traits/full.rs
  additions: 13
  deletions: 3
- path: crates/storage/storage-api/src/noop.rs
  additions: 34
  deletions: 2
- path: crates/storage/storage-api/src/storage.rs
  additions: 41
  deletions: 0
- path: crates/trie/db/src/changesets.rs
  additions: 23
  deletions: 5
- path: crates/trie/db/src/lib.rs
  additions: 3
  deletions: 1
- path: crates/trie/db/src/prefix_set.rs
  additions: 5
  deletions: 8
- path: crates/trie/db/src/state.rs
  additions: 26
  deletions: 30
- path: crates/trie/db/src/storage.rs
  additions: 32
  deletions: 0
- path: docs/vocs/docs/pages/cli/SUMMARY.mdx
  additions: 2
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/checksum/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/clear/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/get/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/settings/set.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/settings/set/storage_changesets.mdx
  additions: 170
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/db/static-file-header/block.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/import-op.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/import-receipts-op.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/init-state.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/init.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/node.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/prune.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/re-execute.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/stage/drop.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/stage/dump.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/stage/run.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/stage/unwind.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/checksum/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/clear/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/get/static-file.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/settings/set.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/settings/set/storage_changesets.mdx
  additions: 170
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/db/static-file-header/block.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/download.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/export-era.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/import-era.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/import.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/init-state.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/init.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/node.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/prune.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/re-execute.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/stage/drop.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/stage/dump.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/stage/run.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/stage/unwind.mdx
  additions: 10
  deletions: 0
- path: docs/vocs/sidebar-cli-op-reth.ts
  additions: 4
  deletions: 0
- path: docs/vocs/sidebar-cli-reth.ts
  additions: 4
  deletions: 0
body: "Adds storage changeset static files, which re-use the changeset offsets introduced in https://github.com/paradigmxyz/reth/pull/18882\r\n\r\nThe entries are sorted by address and key rather than just address.\r\n\r\nAdds support with the `--static-files.storage-change-sets` flag\r\n\r\nCloses RETH-174"
