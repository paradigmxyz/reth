number: 21055
title: 'perf(db): zero-copy database serialization'
state: open
author: DaniPopes
head: dani/zero-copy-mdbx-serialization
base: main
labels:
- C-perf
- A-db
created_at: 2026-01-14T19:22:56Z
updated_at: 2026-01-20T19:16:28Z
additions: 425
deletions: 119
is_draft: true
files:
- path: crates/storage/codecs/src/alloy/transaction/ethereum.rs
  additions: 21
  deletions: 14
- path: crates/storage/db-api/src/models/integer_list.rs
  additions: 4
  deletions: 0
- path: crates/storage/db-api/src/table.rs
  additions: 224
  deletions: 2
- path: crates/storage/db/src/implementation/mdbx/cursor.rs
  additions: 92
  deletions: 90
- path: crates/storage/db/src/implementation/mdbx/tx.rs
  additions: 58
  deletions: 12
- path: crates/storage/libmdbx-rs/src/cursor.rs
  additions: 26
  deletions: 1
body: "Eliminate heap allocations in MDBX write operations by using the mdbx::reserve API to serialize values directly into MDBX-managed memory.\r\n\r\n- Add CountingBuf and SliceBuf helper types for size calculation and direct buffer writing\r\n- Add Compress::compressed_size() method with default implementation\r\n- Add Transaction::reserve_with_dbi() and Cursor::reserve() methods\r\n- Update Tx::put() and cursor write operations to use zero-copy path\r\n- Fall back to allocation-based path for DUPSORT tables (MDBX limitation)\r\n\r\nCloses #21046\r\n\r\nAmp-Thread-ID: https://ampcode.com/threads/T-019bbdb2-01a1-73c8-a1d5-37ca2bedb880"
