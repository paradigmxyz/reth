number: 20832
title: 'feat(cli): add reth report command for debug report generation'
state: open
author: meetrick
head: reth/feat-db-debug-report
base: main
labels: []
created_at: 2026-01-08T08:12:36Z
updated_at: 2026-01-20T17:45:23Z
additions: 1106
deletions: 18
is_draft: false
files:
- path: Cargo.lock
  additions: 8
  deletions: 0
- path: crates/cli/commands/Cargo.toml
  additions: 2
  deletions: 0
- path: crates/cli/commands/src/db/mod.rs
  additions: 1
  deletions: 1
- path: crates/cli/commands/src/lib.rs
  additions: 1
  deletions: 0
- path: crates/cli/commands/src/report.rs
  additions: 450
  deletions: 0
- path: crates/ethereum/cli/src/app.rs
  additions: 1
  deletions: 0
- path: crates/ethereum/cli/src/interface.rs
  additions: 5
  deletions: 1
- path: crates/optimism/cli/src/app.rs
  additions: 1
  deletions: 0
- path: crates/optimism/cli/src/commands/mod.rs
  additions: 5
  deletions: 1
- path: crates/stages/api/src/error.rs
  additions: 21
  deletions: 0
- path: crates/stages/api/src/pipeline/mod.rs
  additions: 2
  deletions: 2
- path: crates/stages/stages/src/stages/merkle.rs
  additions: 14
  deletions: 12
- path: docs/vocs/docs/pages/cli/SUMMARY.mdx
  additions: 3
  deletions: 1
- path: docs/vocs/docs/pages/cli/op-reth.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/op-reth/report.mdx
  additions: 291
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth.mdx
  additions: 1
  deletions: 0
- path: docs/vocs/docs/pages/cli/reth/report.mdx
  additions: 291
  deletions: 0
- path: docs/vocs/sidebar-cli-op-reth.ts
  additions: 4
  deletions: 0
- path: docs/vocs/sidebar-cli-reth.ts
  additions: 4
  deletions: 0
body: "## Motivation\r\nWhen users encounter state root mismatch or EVM execution errors during sync, they need to manually collect multiple pieces of information (checksums, logs, version history, etc.) for bug reports. This process is error-prone, time-consuming, and results in inconsistent reports.\r\n\r\nThis PR addresses issue #18569 and the TODO in the codebase:\r\n```rust\r\n// TODO: automate the process outlined below so the user can just send in a debugging package\r\n```\r\n\r\n## Solution\r\nAdd a new top-level `reth report` command that automates the collection of all necessary debugging information into a single `.tar.gz` archive.\r\n\r\n### Usage\r\n```bash\r\nreth report [--checksum] [-y] [--output report.tar.gz]\r\n```\r\n\r\n### What it collects\r\n| Information | Description |\r\n|-------------|-------------|\r\n| **metadata.json** | Timestamp (UTC), reth version, chain name, data directory |\r\n| **db_stats.json** | Latest block number, table statistics (entries, size), optional checksums |\r\n| **stage_checkpoints.json** | Pipeline stage progress (sync status) |\r\n| **prune_checkpoints.json** | Pruning progress for each segment |\r\n| **version_history.json** | Full VersionHistory table dump |\r\n| **logs/** | All `reth.log*` files from the cache directory |\r\n| **invalid_block_hooks/** | All files from the invalid block hooks directory |\r\n\r\n### Features\r\n- **User consent prompt**: Privacy notice with confirmation before collecting data (`-y` to skip)\r\n- **GitHub issue link**: Generates a pre-filled issue creation URL\r\n- **Checksum option**: `--checksum` flag to include database table checksums (takes a long time)\r\n- **Flexible output**: Custom output path via `--output` flag\r\n\r\n### Error guidance\r\nUpdated error messages to guide users to run `reth report`:\r\n- State root mismatch errors (`INVALID_STATE_ROOT_ERROR_MESSAGE`)\r\n- EVM execution errors (`DEBUG_REPORT_SUGGESTION`)\r\n\r\n## Example Output\r\n```\r\n======================================================================\r\nRETH DEBUG REPORT GENERATOR\r\n======================================================================\r\n\r\nThis tool will collect the following information:\r\n  ‚Ä¢ Database table statistics\r\n  ‚Ä¢ Stage checkpoints (sync progress)\r\n  ‚Ä¢ Prune checkpoints (pruning progress)\r\n  ‚Ä¢ VersionHistory table (client version history)\r\n  ‚Ä¢ Log files from: /Users/user/Library/Caches/reth/logs\r\n  ‚Ä¢ Invalid block hook outputs from: /path/to/datadir/invalid_block_hooks\r\n\r\n‚ö†Ô∏è  PRIVACY NOTICE:\r\n  The generated archive may contain sensitive information about your node.\r\n  Please review the contents before sharing publicly.\r\n\r\nDo you want to proceed? [y/N]: y\r\n\r\n======================================================================\r\nDEBUG REPORT GENERATED SUCCESSFULLY\r\n======================================================================\r\n\r\nArchive saved to: reth_report_20260108_123456Z.tar.gz\r\n\r\nüìã To create a GitHub issue, visit:\r\nhttps://github.com/paradigmxyz/reth/issues/new?title=Debug%20Report&labels=C-bug\r\n\r\n‚ö†Ô∏è  IMPORTANT:\r\n   ‚Ä¢ You must be logged into GitHub in your browser\r\n   ‚Ä¢ The issue will be created under YOUR GitHub account\r\n   ‚Ä¢ Please attach the generated archive to your issue\r\n   ‚Ä¢ Review the archive contents before sharing\r\n```\r\n\r\n## Documentation\r\nAdded CLI documentation for both `reth` and `op-reth`:\r\n\r\n| File | Change |\r\n|------|--------|\r\n| `docs/vocs/docs/pages/cli/reth/report.mdx` | New command documentation |\r\n| `docs/vocs/docs/pages/cli/op-reth/report.mdx` | New command documentation |\r\n| `docs/vocs/sidebar-cli-reth.ts` | Added sidebar entry |\r\n| `docs/vocs/sidebar-cli-op-reth.ts` | Added sidebar entry |\r\n\r\n## Related\r\nCloses #18569 (MVP implementation without S3 upload - can be added in follow-up PR)"
