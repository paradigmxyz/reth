number: 21245
title: 'feat(rpc): implement debug_getBlockAccessList (EIP-7928)'
state: open
author: mattsse
head: feat/debug-get-block-access-list
base: main
labels:
- C-enhancement
- A-rpc
- E-Amsterdam
created_at: 2026-01-21T10:23:30Z
updated_at: 2026-01-21T10:35:15Z
additions: 278
deletions: 10
is_draft: false
files:
- path: Cargo.lock
  additions: 1
  deletions: 1
- path: Cargo.toml
  additions: 1
  deletions: 1
- path: crates/ethereum/node/Cargo.toml
  additions: 1
  deletions: 0
- path: crates/ethereum/node/tests/e2e/debug.rs
  additions: 214
  deletions: 0
- path: crates/ethereum/node/tests/e2e/main.rs
  additions: 1
  deletions: 0
- path: crates/rpc/rpc-api/Cargo.toml
  additions: 0
  deletions: 1
- path: crates/rpc/rpc-api/src/debug.rs
  additions: 3
  deletions: 3
- path: crates/rpc/rpc/src/debug.rs
  additions: 56
  deletions: 4
- path: crates/rpc/rpc/src/lib.rs
  additions: 1
  deletions: 0
body: "## Summary\n\nImplements the `debug_getBlockAccessList` RPC endpoint as specified in [EIP-7928](https://eips.ethereum.org/EIPS/eip-7928).\n\nThis endpoint replays a block and generates the Block Access List (BAL), which tracks all state changes (balance, nonce, code, storage) per transaction.\n\n## Implementation Details\n\n- Uses revm's built-in BAL tracking via `State::builder().with_bal_builder()`\n- Follows BAL index convention: 0 for pre-execution, 1..n for transactions, n+1 for post-execution\n- Returns RLP-encoded `BlockAccessList` as `Bytes`\n- Acquires trace permit for concurrency limiting (same as other tracing endpoints)\n\n## Changes\n\n- Added `debug_getBlockAccessList` to the debug RPC API trait\n- Implemented the endpoint using revm's state builder with BAL tracking\n- Added e2e tests for the endpoint\n- Enabled `alloy-eip7928` with RLP feature in workspace\n\n## Testing\n\nAdded e2e tests in `crates/ethereum/node/tests/e2e/debug.rs`:\n- `test_debug_get_block_access_list` - Tests storage changes from contract interaction\n- `test_debug_get_block_access_list_empty_block` - Tests empty block returns empty BAL  \n- `test_debug_get_block_access_list_multiple_txs` - Tests multiple transactions in one block\n\ncc @Soubhik-10 @Rimeeeeee\n\nCloses #20269"
