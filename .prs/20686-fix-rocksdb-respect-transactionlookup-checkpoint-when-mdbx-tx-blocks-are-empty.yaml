number: 20686
title: 'fix(rocksdb): respect TransactionLookup checkpoint when MDBX tx blocks are empty'
state: open
author: VolodymyrBg
head: fix/rocksdb-txhash-checkpoint-invariant
base: main
labels:
- A-rocksdb
created_at: 2025-12-30T17:06:30Z
updated_at: 2026-01-10T15:16:41Z
additions: 74
deletions: 0
is_draft: false
files:
- path: crates/storage/provider/src/providers/rocksdb/invariants.rs
  additions: 74
  deletions: 0
body: "The RocksDB consistency check for TransactionHashNumbers now treats the state (mdbx_last = None, highest_static_tx = Some(..), checkpoint > 0) as an inconsistency that requires an unwind to block 0, instead of only pruning RocksDB and returning no unwind target.\r\n\r\nThis makes the (None, Some(..)) branch consistent with the existing behaviour for (None, None, checkpoint > 0) and with how other history tables handle non-zero checkpoints with empty backing data. The behaviour for checkpoint == 0 is unchanged. A regression test was added to cover this scenario explicitly."
